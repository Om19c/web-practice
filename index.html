<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GraphTutor — Interactive Graph Playground</title>
  <style>
    :root{--bg:#0b1220;--card:#071026;--muted:#94a3b8;--accent:#60a5fa;--accent2:#a78bfa;--good:#34d399;--danger:#fb7185}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:linear-gradient(180deg,#071026 0%, #071428 100%);color:#e6eef8;padding:18px}
    .app{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:340px 1fr;gap:18px}
    header{grid-column:1/-1;display:flex;align-items:center;gap:12px;margin-bottom:8px}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:800}
    h1{font-size:18px;margin:0}
    .subtitle{color:var(--muted);font-size:13px}

    /* left column */
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,0.03)}
    nav .btn{display:block;width:100%;padding:10px;border-radius:10px;border:none;background:transparent;color:var(--muted);text-align:left;margin-bottom:8px;cursor:pointer}
    nav .btn.active{background:rgba(96,165,250,0.06);color:var(--accent);border:1px solid rgba(96,165,250,0.08)}

    /* playground */
    .canvas-wrap{height:520px;border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,0.03)}
    #canvas{background:#071428;display:block;width:100%;height:520px}
    .controls{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
    .controls button{padding:8px 10px;border-radius:8px;border:none;cursor:pointer;background:var(--accent);color:#04233a;font-weight:700}
    .controls .alt{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .small{font-size:13px;color:var(--muted)}

    /* tutorial */
    .lesson-title{font-size:15px;margin-bottom:6px}
    .lesson-text{color:#cfe6ff;line-height:1.5}
    .example-graph{display:flex;gap:8px;margin-top:10px}
    .chip{padding:6px 10px;border-radius:8px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);cursor:pointer}

    .alg-panel{display:flex;gap:8px;align-items:center;margin-top:10px}
    select{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}

    footer{grid-column:1/-1;margin-top:12px;color:var(--muted);font-size:13px}

    @media (max-width:1000px){.app{grid-template-columns:1fr} #canvas{height:420px}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo">GT</div>
      <div>
        <h1>GraphTutor — Interactive Graph Playground</h1>
        <div class="subtitle">Build graphs • Run algorithms step-by-step • Guided examples — all frontend</div>
      </div>
    </header>

    <aside class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <div>
          <div class="small">Mode</div>
          <div style="font-weight:700">Interactive + Tutorial</div>
        </div>
        <div class="small">No backend • Local-only</div>
      </div>

      <nav>
        <button class="btn active" data-tab="play">Playground</button>
        <button class="btn" data-tab="tutorial">Tutorial</button>
        <button class="btn" data-tab="algorithms">Algorithms</button>
      </nav>

      <div style="height:12px"></div>
      <div class="small" style="margin-bottom:6px">Quick actions</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button id="addNode" class="chip">Add Node (N)</button>
        <button id="randEdge" class="chip">Random Edge (R)</button>
        <button id="clear" class="chip">Clear</button>
        <button id="export" class="chip">Export</button>
        <button id="import" class="chip">Import</button>
      </div>

      <div style="height:14px"></div>
      <div class="small">Tips</div>
      <ul style="color:var(--muted);font-size:13px;line-height:1.4;margin-top:6px">
        <li>Drag nodes to reposition</li>
        <li>Click a node to start an edge, click another node to finish</li>
        <li>Right-click node/edge to delete</li>
        <li>Click a node to select as algorithm start</li>
      </ul>

    </aside>

    <main>
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div class="small">Interactive Canvas</div>
            <div style="font-weight:700">Playground</div>
          </div>
          <div class="small">Nodes: <strong id="nCount">3</strong> • Edges: <strong id="eCount">3</strong> • Visited: <strong id="vCount">0</strong></div>
        </div>

        <div class="canvas-wrap">
          <canvas id="canvas" width="900" height="520"></canvas>
        </div>

        <div class="controls">
          <button id="run" class="alt">Run Algorithm</button>
          <select id="algo"><option value="bfs">BFS</option><option value="dfs">DFS</option><option value="dijkstra">Dijkstra</option></select>
          <button id="stepBack" class="alt">◀ Step</button>
          <button id="stepFwd" class="alt">Step ▶</button>
          <button id="playPause" class="alt">Play ▶</button>
          <div style="margin-left:auto" class="small">Start Node: <strong id="startNode">A</strong></div>
        </div>

      </div>

      <div id="info" class="card" style="margin-top:12px">
        <div class="lesson-title">Live Info</div>
        <div class="lesson-text" id="infoText">Click nodes to interact. Use controls to run algorithms. Distances are shown for Dijkstra.</div>
      </div>
    </main>

    <section class="card" id="sidePanel">
      <div id="tutorialBlock">
        <div class="lesson-title">Tutorial</div>
        <div class="lesson-text" id="tutText">Follow guided examples to learn traversals and shortest paths. Pick one and press "Load Example".</div>
        <div class="example-graph">
          <div class="chip" data-example="triangle">Triangle (BFS)</div>
          <div class="chip" data-example="line">Line (DFS)</div>
          <div class="chip" data-example="weights">Weighted (Dijkstra)</div>
        </div>
        <div style="height:10px"></div>
        <div style="display:flex;gap:8px">
          <button id="loadExample" class="chip">Load Example</button>
          <button id="autoRun" class="chip">Auto Run</button>
        </div>
      </div>

      <div id="algPanel" style="display:none;margin-top:12px">
        <div class="lesson-title">Algorithms</div>
        <div class="lesson-text">Choose an algorithm, click a node to select start, then Run. You can step forward/back or play animation.</div>
      </div>

      <input id="file" type="file" accept="application/json" style="display:none" />
    </section>

    <footer>GraphTutor — front-end only. Built for learning and experimentation.</footer>
  </div>

  <script>
    // Canvas & State
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let rect = canvas.getBoundingClientRect();
    let nodes = [ {id:0,x:160,y:150,label:'A'}, {id:1,x:420,y:120,label:'B'}, {id:2,x:300,y:300,label:'C'} ];
    let edges = [ {from:0,to:1,weight:1}, {from:1,to:2,weight:1}, {from:0,to:2,weight:1} ];
    let nextId = 3;
    let drag = null; let off = {x:0,y:0};
    let edgeStart = null; let selectedNode = null; let visitedNodes = new Set(); let visitedEdges = new Set();

    // Algorithm UI state
    let algSteps = [], algIndex = -1, playTimer = null, playing=false, distMap=null;

    const nCount = document.getElementById('nCount'); const eCount = document.getElementById('eCount'); const vCount = document.getElementById('vCount');
    const startNodeLabel = document.getElementById('startNode');

    function updateStats(){ nCount.textContent = nodes.length; eCount.textContent = edges.length; vCount.textContent = visitedNodes.size; startNodeLabel.textContent = selectedNode ? selectedNode.label : '-'; }

    function draw(){ ctx.clearRect(0,0,canvas.width,canvas.height);
      // edges
      edges.forEach(e=>{
        const a = nodes.find(n=>n.id===e.from); const b = nodes.find(n=>n.id===e.to); if(!a||!b) return;
        ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y);
        const key = `${e.from}-${e.to}`;
        ctx.strokeStyle = visitedEdges.has(key) ? 'rgba(96,165,250,0.9)' : 'rgba(255,255,255,0.06)';
        ctx.lineWidth = visitedEdges.has(key) ? 4 : 2; ctx.stroke();
        const mx=(a.x+b.x)/2, my=(a.y+b.y)/2; ctx.fillStyle='rgba(255,255,255,0.03)'; ctx.fillRect(mx-18,my-14,36,22); ctx.fillStyle='#cfe6ff'; ctx.font='12px sans-serif'; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(e.weight||1,mx,my);
      });
      // nodes
      nodes.forEach(n=>{
        ctx.beginPath(); ctx.arc(n.x,n.y,22,0,2*Math.PI);
        const fill = visitedNodes.has(n.id) ? 'rgba(96,165,250,0.14)' : 'rgba(255,255,255,0.02)';
        ctx.fillStyle = fill; ctx.fill(); ctx.lineWidth=2; ctx.strokeStyle='rgba(255,255,255,0.06)'; ctx.stroke();
        ctx.fillStyle = '#e6eef8'; ctx.font='bold 14px sans-serif'; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(n.label,n.x,n.y);
        if(distMap && distMap[n.id]!==Infinity){ ctx.font='11px sans-serif'; ctx.fillStyle='#cfe6ff'; ctx.fillText('d='+distMap[n.id], n.x, n.y+32); }
      });

      // edgeStart preview
      if(edgeStart){ ctx.beginPath(); ctx.arc(edgeStart.x,edgeStart.y,6,0,2*Math.PI); ctx.fillStyle='rgba(96,165,250,0.9)'; ctx.fill(); }
    }

    function addNode(x=100+Math.random()*600, y=80+Math.random()*360){ const n={id:nextId,x,y,label:String.fromCharCode(65+nextId)}; nodes.push(n); nextId++; saveSnapshot(); draw(); updateStats(); }
    function addRandomEdge(){ if(nodes.length<2) return; const a=nodes[Math.floor(Math.random()*nodes.length)].id; let b=nodes[Math.floor(Math.random()*nodes.length)].id; while(b===a) b=nodes[Math.floor(Math.random()*nodes.length)].id; edges.push({from:a,to:b,weight:Math.floor(Math.random()*9)+1}); saveSnapshot(); draw(); updateStats(); }
    function clearGraph(){ if(!confirm('Clear graph?')) return; nodes=[]; edges=[]; nextId=0; selectedNode=null; visitedNodes=new Set(); visitedEdges=new Set(); algSteps=[]; algIndex=-1; distMap=null; saveSnapshot(); draw(); updateStats(); }

    // mouse interactions
    canvas.addEventListener('mousedown', (ev)=>{
      const p = getPos(ev); const hit = nodes.find(n=>dist(n,p)<22);
      if(hit){ drag=hit; off.x = p.x-hit.x; off.y = p.y-hit.y; selectedNode=hit; edgeStart=null; updateStats(); draw(); }
      else{ // create node
        const n = {id:nextId,x:p.x,y:p.y,label:String.fromCharCode(65+nextId)}; nodes.push(n); nextId++; saveSnapshot(); draw(); updateStats(); }
    });
    canvas.addEventListener('mousemove', (ev)=>{ if(!drag) return; const p=getPos(ev); drag.x = p.x - off.x; drag.y = p.y - off.y; draw(); });
    canvas.addEventListener('mouseup', ()=>{ drag=null; saveSnapshot(); });

    canvas.addEventListener('click', (ev)=>{
      const p=getPos(ev); const hit = nodes.find(n=>dist(n,p)<22);
      if(hit){ // edge creation or select
        if(edgeStart && edgeStart.id!==hit.id){ edges.push({from:edgeStart.id,to:hit.id,weight:1}); edgeStart=null; saveSnapshot(); draw(); updateStats(); }
        else { edgeStart = hit; selectedNode = hit; updateStats(); draw(); }
      }
    });

    canvas.addEventListener('contextmenu', (ev)=>{
      ev.preventDefault(); const p=getPos(ev); const hitIndex = nodes.findIndex(n=>dist(n,p)<22);
      if(hitIndex>=0){ const nid = nodes[hitIndex].id; nodes.splice(hitIndex,1); edges = edges.filter(e=>e.from!==nid && e.to!==nid); saveSnapshot(); draw(); updateStats(); return; }
      // else delete edge near click
      const edIndex = edges.findIndex(ed=>{
        const a=nodes.find(n=>n.id===ed.from); const b=nodes.find(n=>n.id===ed.to); if(!a||!b) return false; const d1 = Math.hypot(p.x-a.x,p.y-a.y); const d2 = Math.hypot(p.x-b.x,p.y-b.y); const line = Math.hypot(a.x-b.x,a.y-b.y); return Math.abs(d1+d2-line) < 6;
      });
      if(edIndex>=0){ edges.splice(edIndex,1); saveSnapshot(); draw(); updateStats(); }
    });

    function getPos(ev){ rect = canvas.getBoundingClientRect(); return {x: (ev.clientX - rect.left) * (canvas.width/rect.width), y: (ev.clientY - rect.top) * (canvas.height/rect.height)}; }
    function dist(a,b){ return Math.hypot(a.x-b.x,a.y-b.y); }

    // export / import
    document.getElementById('export').addEventListener('click', ()=>{ const data = JSON.stringify({nodes,edges}); const blob=new Blob([data],{type:'application/json'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='graph.json'; a.click(); URL.revokeObjectURL(url); });
    document.getElementById('import').addEventListener('click', ()=> document.getElementById('file').click());
    document.getElementById('file').addEventListener('change', (ev)=>{ const f=ev.target.files[0]; if(!f) return; const r=new FileReader(); r.onload= e=>{ try{ const p=JSON.parse(e.target.result); nodes = p.nodes||[]; edges = p.edges||[]; nextId = nodes.length? Math.max(...nodes.map(n=>n.id))+1:0; saveSnapshot(); draw(); updateStats(); }catch(er){ alert('Invalid JSON'); } }; r.readAsText(f); });

    // keyboard shortcuts
    window.addEventListener('keydown', (e)=>{ if(e.key==='n') addNode(); if(e.key==='r') addRandomEdge(); if(e.key===' ') togglePlay(); });

    // basic persistence (snapshot) for undo-ish behavior
    function saveSnapshot(){ localStorage.setItem('graphtutor_snapshot', JSON.stringify({nodes,edges,nextId})); }
    (function loadSnapshot(){ try{ const s=JSON.parse(localStorage.getItem('graphtutor_snapshot')||'null'); if(s){ nodes=s.nodes||[]; edges=s.edges||[]; nextId=s.nextId||nodes.length; } }catch(e){} })();

    // Algorithm implementations (BFS, DFS, Dijkstra)
    function buildAdj(){ const adj={}; nodes.forEach(n=>adj[n.id]=[]); edges.forEach(e=>{ if(!adj[e.from]) adj[e.from]=[]; if(!adj[e.to]) adj[e.to]=[]; adj[e.from].push({to:e.to,weight:e.weight||1}); adj[e.to].push({to:e.from,weight:e.weight||1}); }); return adj; }

    function runBFS(start){ const adj=buildAdj(); const q=[start]; const vis=new Set(); const steps=[]; while(q.length){ const u=q.shift(); if(vis.has(u)) continue; vis.add(u); steps.push({type:'visit',node:u}); const neigh = adj[u]||[]; neigh.forEach(n=>{ if(!vis.has(n.to) && !q.includes(n.to)){ steps.push({type:'edge',from:u,to:n.to}); q.push(n.to); } }); } return steps; }
    function runDFS(start){ const adj=buildAdj(); const vis=new Set(); const steps=[]; function dfs(u){ vis.add(u); steps.push({type:'visit',node:u}); (adj[u]||[]).forEach(n=>{ if(!vis.has(n.to)){ steps.push({type:'edge',from:u,to:n.to}); dfs(n.to); } }); } dfs(start); return steps; }
    function runDijkstra(start){ const adj=buildAdj(); const dist = {}; const prev={}; nodes.forEach(n=>dist[n.id]=Infinity); dist[start]=0; const Q = new Set(nodes.map(n=>n.id)); const steps=[]; while(Q.size){ let u=null,best=Infinity; for(const id of Q){ if(dist[id]<best){best=dist[id]; u=id;} } if(u===null || best===Infinity) break; Q.delete(u); steps.push({type:'visit',node:u}); (adj[u]||[]).forEach(e=>{ const alt = dist[u]+(e.weight||1); if(alt < dist[e.to]){ dist[e.to]=alt; prev[e.to]=u; steps.push({type:'edge',from:u,to:e.to}); } }); } steps.push({type:'dist',dist}); return steps; }

    function prepareAlg(){ if(!selectedNode){ alert('Select a start node by clicking a node.'); return false; } const alg = document.getElementById('algo').value; if(alg==='bfs') algSteps = runBFS(selectedNode.id); else if(alg==='dfs') algSteps = runDFS(selectedNode.id); else algSteps = runDijkstra(selectedNode.id); algIndex = -1; visitedNodes = new Set(); visitedEdges = new Set(); distMap = null; updateStats(); return true; }

    document.getElementById('run').addEventListener('click', ()=>{ if(!prepareAlg()) return; stepForward(); });
    function stepForward(){ if(algIndex < algSteps.length-1){ algIndex++; applyStep(algSteps[algIndex]); } }
    function stepBack(){ if(algIndex>0){ // reset and reapply up to algIndex-1
        algIndex--; rebuildFromSteps(algIndex); } }
    document.getElementById('stepFwd').addEventListener('click', stepForward);
    document.getElementById('stepBack').addEventListener('click', stepBack);

    function applyStep(s){ if(!s) return; if(s.type==='visit'){ visitedNodes.add(s.node); selectedNode = nodes.find(n=>n.id===s.node); }
      else if(s.type==='edge'){ visitedEdges.add(`${s.from}-${s.to}`); }
      else if(s.type==='dist'){ distMap = s.dist; }
      updateStats(); draw(); }

    function rebuildFromSteps(idx){ visitedNodes = new Set(); visitedEdges = new Set(); distMap=null; selectedNode = null; for(let i=0;i<=idx;i++){ const s = algSteps[i]; if(s.type==='visit'){ visitedNodes.add(s.node); selectedNode = nodes.find(n=>n.id===s.node); } else if(s.type==='edge'){ visitedEdges.add(`${s.from}-${s.to}`); } else if(s.type==='dist'){ distMap = s.dist; } } updateStats(); draw(); }

    function play(){ if(playing) return; if(algSteps.length===0) return; playing=true; document.getElementById('playPause').textContent='Pause ❚❚'; playTimer = setInterval(()=>{ if(algIndex < algSteps.length-1){ algIndex++; applyStep(algSteps[algIndex]); } else { stopPlay(); } }, 700); }
    function stopPlay(){ playing=false; clearInterval(playTimer); document.getElementById('playPause').textContent='Play ▶'; }
    function togglePlay(){ if(playing) stopPlay(); else play(); }
    document.getElementById('playPause').addEventListener('click', togglePlay);

    // Tutorial example loaders
    document.querySelectorAll('.chip[data-example]').forEach(el=> el.addEventListener('click', ()=>{ document.querySelectorAll('.chip[data-example]').forEach(x=>x.style.borderColor=''); el.style.borderColor='var(--accent)'; el.dataset.sel='1'; }));
    document.getElementById('loadExample').addEventListener('click', ()=>{
      const sel = Array.from(document.querySelectorAll('.chip[data-example]')).find(x=>x.dataset.sel==='1'); if(!sel){ alert('Pick an example first'); return; }
      const which = sel.dataset.example; if(which==='triangle'){ nodes=[{id:0,x:170,y:160,label:'A'},{id:1,x:430,y:160,label:'B'},{id:2,x:300,y:320,label:'C'}]; edges=[{from:0,to:1,weight:1},{from:1,to:2,weight:1},{from:0,to:2,weight:1}]; nextId=3; }
      else if(which==='line'){ nodes=[{id:0,x:140,y:150,label:'A'},{id:1,x:300,y:150,label:'B'},{id:2,x:460,y:150,label:'C'},{id:3,x:620,y:150,label:'D'}]; edges=[{from:0,to:1,weight:1},{from:1,to:2,weight:1},{from:2,to:3,weight:1}]; nextId=4; }
      else { nodes=[{id:0,x:140,y:150,label:'A'},{id:1,x:320,y:120,label:'B'},{id:2,x:500,y:160,label:'C'},{id:3,x:320,y:300,label:'D'}]; edges=[{from:0,to:1,weight:4},{from:1,to:2,weight:1},{from:0,to:3,weight:2},{from:3,to:2,weight:3}]; nextId=4; }
      visitedNodes=new Set(); visitedEdges=new Set(); distMap=null; algSteps=[]; algIndex=-1; saveSnapshot(); draw(); updateStats();
    });

    document.getElementById('autoRun').addEventListener('click', ()=>{
      // load selected example then run default algorithm
      const sel = Array.from(document.querySelectorAll('.chip[data-example]')).find(x=>x.dataset.sel==='1'); if(!sel){ alert('Pick an example first'); return; }
      document.getElementById('loadExample').click(); const ex = sel.dataset.example; if(ex==='weights') document.getElementById('algo').value='dijkstra'; else document.getElementById('algo').value = ex==='line' ? 'dfs' : 'bfs'; setTimeout(()=>{ if(prepareAlg()) play(); },300);
    });

    // tabs
    document.querySelectorAll('nav .btn').forEach(b=> b.addEventListener('click', (e)=>{ document.querySelectorAll('nav .btn').forEach(x=>x.classList.remove('active')); e.currentTarget.classList.add('active'); const t = e.currentTarget.textContent.trim().toLowerCase(); document.getElementById('tutorialBlock').style.display = t==='tutorial' ? 'block':'none'; document.getElementById('algPanel').style.display = t==='algorithms' ? 'block':'none'; }));

    // initial draw
    updateStats(); draw();
  </script>
</body>
</html>
